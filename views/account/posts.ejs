<%- include('../_admin_page_headers/admin_top') %>

<div class="fs-2 text-dark">
  <span class="svg-icon svg-icon-2 svg-icon-dark">
    <svg
      xmlns="http://www.w3.org/2000/svg"
      width="24"
      height="24"
      viewBox="0 0 24 24"
      fill="none">
      <rect x="2" y="2" width="9" height="9" rx="2" fill="currentColor"></rect>
      <rect
        opacity="0.3"
        x="13"
        y="2"
        width="9"
        height="9"
        rx="2"
        fill="currentColor"></rect>
      <rect
        opacity="0.3"
        x="13"
        y="13"
        width="9"
        height="9"
        rx="2"
        fill="currentColor"></rect>
      <rect
        opacity="0.3"
        x="2"
        y="13"
        width="9"
        height="9"
        rx="2"
        fill="currentColor"></rect>
    </svg> </span
  >Reservations
</div>
<hr class="text-dark" />

<div class="mb-6">
  <button
    class="btn shadow btn-light-dark btn-hover-rise btn-sm me-2 border border-dark"
    data-bs-toggle="modal"
    data-bs-target="#add_reservation">
    <div>Add Reservation</div>
  </button>
</div>

<div>
  <!-- Filter Form -->
  <div class="mb-3">
    <span class="svg-icon svg-icon-primary me-2 svg-icon-2"
      ><svg
        xmlns="http://www.w3.org/2000/svg"
        width="24"
        height="24"
        viewBox="0 0 24 24"
        fill="none">
        <path
          d="M17.5 11H6.5C4 11 2 9 2 6.5C2 4 4 2 6.5 2H17.5C20 2 22 4 22 6.5C22 9 20 11 17.5 11ZM15 6.5C15 7.9 16.1 9 17.5 9C18.9 9 20 7.9 20 6.5C20 5.1 18.9 4 17.5 4C16.1 4 15 5.1 15 6.5Z"
          fill="black" />
        <path
          opacity="0.3"
          d="M17.5 22H6.5C4 22 2 20 2 17.5C2 15 4 13 6.5 13H17.5C20 13 22 15 22 17.5C22 20 20 22 17.5 22ZM4 17.5C4 18.9 5.1 20 6.5 20C7.9 20 9 18.9 9 17.5C9 16.1 7.9 15 6.5 15C5.1 15 4 16.1 4 17.5Z"
          fill="black" /></svg></span
    >Search<span class="fs-8 fw-normal text-danger ms-2"
      ><%- locals.search_string %></span
    >
    <a href="/reservations" class="fs-8 text-primary ms-2"> (Clear)</a>
  </div>
  <div class="card border border-dark shadow mb-6">
    <div class="card-body py-2 scroll">
      <form action="/reservations">
        <table class="table align-middle gy-1 gs-7 mt-2">
          <thead>
            <tr>
              <th>
                <div class="fs-8 fw-bolder text-dark">Room Number</div>

                <input
                  type="text"
                  name="room_number"
                  id="room_number"
                  step="1"
                  class="rounded form-control form-control-sm border border-dark" />
              </th>

              <th>
                <div class="fs-8 fw-bolder text-dark">Room Type</div>

                <select
                  class="form-select form-select-sm rounded border border-dark"
                  name="reservation_status">
                  <option value="">Select</option>
                  <option value="Exec">Exec</option>
                </select>
              </th>

              <th>
                <div class="fs-8 fw-bolder text-dark">Booking Type</div>

                <select
                  class="form-select form-select-sm rounded border border-dark"
                  name="reservation_status">
                  <option value="">Select</option>
                  <option value="Booked">Internal Reservations</option>
                </select>
              </th>

              <th>
                <div class="fs-8 fw-bolder text-dark">
                  Occupied by <span class="fw-light">(National ID)</span>
                </div>

                <input
                  type="text"
                  name="national_id"
                  id="national_id"
                  step="1"
                  class="rounded form-control form-control-sm border border-dark" />
              </th>

              <th>
                <div class="fs-8 fw-bolder text-dark">Company Name</div>

                <input
                  type="text"
                  name="company_name"
                  id="company_name"
                  step="1"
                  class="rounded form-control form-control-sm border border-dark" />
              </th>

              <th>
                <div class="fs-8 fw-bolder text-dark">Check In Date</div>

                <input
                  type="date"
                  name="check_in_date"
                  id="check_in_date"
                  step="1"
                  class="rounded form-control form-control-sm border border-dark" />
              </th>

              <th>
                <div class="fs-8 fw-bolder text-dark">Check Out Date</div>

                <input
                  type="date"
                  name="check_out_date"
                  id="check_out_date"
                  step="1"
                  class="rounded form-control form-control-sm border border-dark" />
              </th>

              <th>
                <div class="fs-8 fw-bolder text-dark">Reservation Status</div>

                <select
                  class="form-select form-select-sm rounded border border-dark"
                  name="reservation_status">
                  <option value="">Select</option>
                  <option value="Booked">Booked</option>
                  <option value="Pending">Pending</option>
                  <option value="Suspended">Suspended</option>
                </select>
              </th>

              <th>
                <button
                  type="submit"
                  class="btn btn-dark btn-sm btn-hover-rise rounded">
                  <li class="fa fa-search"></li>
                </button>
              </th>
            </tr>
          </thead>
        </table>
      </form>
    </div>
  </div>
  <!-- End Filter Form -->

  <!-- Table -->
  <div class="card shadow border border-dark">
    <div class="card-body">
      <table
        id="_table"
        class="table table-row-bordered gy-3 gs-7 border rounded">
        <thead>
          <tr class="fw-bolder fs-6 text-gray-800 px-7">
            <th>Room Number</th>
            <th>Room Type</th>
            <th>National Id</th>
            <th>Booking Type</th>
            <th>Company Name</th>
            <th>Adults Number</th>
            <th>Kids Number</th>
            <th>Check In Status</th>
            <th>Check Out Status</th>
            <th>Check In Date</th>
            <th>Check Out Date</th>
            <th>Reservations status</th>
          </tr>
        </thead>
        <tbody>
          <script>
            const empty = <%- JSON.stringify(locals.empty) || `[]` %>

            empty.forEach(element => {
              document.write(`
                <tr onclick="window.location.href='${element.id}'" class="hoverable bg-hover-secondary">
                  <td>${element.number}</td>
                  <td>${element.room_type}</td>
                  <td>${element.booking_type}</td>
                  <td>${element.national_id}</td>
                  <td>${element.booking_type}</td>
                  <td>${element.company_name}</td>
                  <td>${element.adult_number}</td>
                  <td>${element.kids_number}</td>
                  <td>${element.check_in_status}</td>
                  <td>${element.check_out_status}</td>
                  <td>${element.check_in_date}</td>
                  <td>${element.check_out_date}</td>
                  <td>${element.reservation_status}</td>

                </tr>
              `);

            });
          </script>
        </tbody>
      </table>
    </div>
  </div>
  <!-- End Table -->
</div>

<!-- MODAL -->
<div class="modal fade" tabindex="-1" id="add_reservation">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-body">
        <h5 class="modal-title">
          <span class="svg-icon svg-icon-dark svg-icon-3"> </span>Add
          Reservation
        </h5>

        <div class="row">
          <div class="col-sm-6 mt-6">
            <label class="fw-bolder fs-8">Room Number </label>
            <input
              type="text"
              id="room_number"
              class="form-control form-control-sm" />
            <span class="text-danger" id="label_room_number"></span>
          </div>
          <div class="col-sm-6 mt-6">
            <label class="fw-bolder fs-8">Room Type </label>
            <input
              type="text"
              id="room_type"
              class="form-control form-control-sm" />
            <span class="text-danger" id="label_room_type"></span>
          </div>

          <div class="col-sm-6 mt-6">
            <label class="fw-bolder fs-8">National Id </label>
            <input
              type="text"
              id="national_id"
              class="form-control form-control-sm" />
            <span class="text-danger" id="label_national_id"></span>
          </div>

          <div class="col-sm-6 mt-6">
            <label class="fw-bolder fs-8">Booking Type </label>
            <input
              type="text"
              id="booking_type"
              class="form-control form-control-sm" />
            <span class="text-danger" id="label_booking_type"></span>
          </div>

          <div class="col-sm-6 mt-6">
            <label class="fw-bolder fs-8">Company Name </label>
            <input
              type="text"
              id="company_name"
              class="form-control form-control-sm" />
            <span class="text-danger" id="label_company_name"></span>
          </div>

          <div class="col-sm-6 mt-6">
            <label class="fw-bolder fs-8">Adults Number </label>
            <input
              type="number"
              id="adult_number"
              class="form-control form-control-sm"
              step="0" />
            <span class="text-danger" id="label_adult_number"></span>
          </div>

          <div class="col-sm-6 mt-6">
            <label class="fw-bolder fs-8">Kids Number </label>
            <input
              type="number"
              id="kids_number"
              class="form-control form-control-sm" />
            <span class="text-danger" id="label_kids_number"></span>
          </div>

          <div class="col-sm-6 mt-6">
            <label class="fw-bolder fs-8">Check In date </label>
            <input
              type="text"
              id="check_in_date"
              class="form-control form-control-sm" />
            <span class="text-danger" id="label_check_in_date"></span>
          </div>

          <div class="col-sm-6 mt-6">
            <label class="fw-bolder fs-8">Check Out date </label>
            <input
              type="text"
              id="check_out_date"
              class="form-control form-control-sm" />
            <span class="text-danger" id="label_check_out_date"></span>
          </div>

          <div class="col-sm-6 mt-6">
            <label class="fw-bolder fs-8">Reservation status </label>

            <select
              name=""
              id="reservation_status"
              class="form-select form-select-sm mb-3">
              <option value=""></option>
              <option value="Pending">Pending</option>
              <option value="Booked">Booked</option>
              <option value="Suspended">Suspended</option>
            </select>

            <div class="text-danger" id="label_reservation_status"></div>
          </div>
        </div>

        <div class="modal-footer">
          <button
            type="button"
            class="btn btn-sm btn-light-danger"
            data-bs-dismiss="modal">
            Cancel
          </button>
          <button
            type="button"
            class="btn btn-sm btn-primary"
            onclick="query_add_reservation()">
            Submit <span id="btn_add_reservation"></span>
          </button>
        </div>
      </div>
    </div>
  </div>

  <script>

    var room_number;
      var room_type;
      var national_id,
      var booking_type,
      var company_name,
      var adult_number,
      var kids_number,
      var check_in_date,
      var check_out_date,
      var reservation_status;


      function update_globals() {
        // Labels

        room_number = $("#room_number").val();
        $("#label_room_number").html("");
        $("#room_number").removeClass("border-danger");

        room_type = $("#  var room_type").val();
        $("#label_room_type").html("");
        $("#  var room_type").removeClass("border-danger");

        national_id = $("#national_id").val();
        $("#label_national_id").html("");
        $("#national_id").removeClass("border-danger");

        booking_type = $("#booking_type").val();
        $("#label_booking_type").html("");
        $("#booking_type").removeClass("border-danger");

        company_name = $("#company_name").val();
        $("#label_company_name").html("");
        $("#company_name").removeClass("border-danger");

        adult_number = $("#adult_number").val();
        $("#label_adult_number").html("");
        $("#adult_number").removeClass("border-danger");

        kids_number = $("#kids_number").val();
        $("#label_kids_number").html("");
        $("#kids_number").removeClass("border-danger");


        check_in_date = $("#check_in_date").val();
        $("#label_check_in_date").html("");
        $("#check_in_date").removeClass("border-danger");

        check_out_date = $("#check_out_date").val();
        $("#label_check_out_date").html("");
        $("#check_out_date").removeClass("border-danger");

        reservation_status = $("#reservation_status").val();
        $("#label_reservation_status").html("");
        $("#reservation_status").removeClass("border-danger");
    }

      let form_data = new FormData();

            <button type="button" class="btn btn-sm btn-primary" onclick="query_add_reservation()">Submit <span id="btn_add_reservation"></span></button>
      async function query_add_reservation() {
        update_globals();

        form_data = new FormData();

        form_data.append("room_number", room_number);
        form_data.append("room_type", room_type);
        form_data.append("national_id", national_id);
        form_data.append("booking_type", booking_type);
        form_data.append("company_name", company_name);
        form_data.append("adult_number", adult_number);
        form_data.append("kids_number", kids_number);
        form_data.append("check_in_date", check_in_date);
        form_data.append("check_out_date", check_out_date);
        form_data.append("reservation_status", reservation_status);

        set_loading_spinner("btn_add_reservation");
        url = "/reservations";
        ajax_response = await ajax_request_jquery(url, form_data);
        release_loading_spinner("btn_add_reservation");

        console.log(ajax_response);
        // >>>>>>>>>>>>>> Response
        const success_response = () => {
          _display_success_server_res_msg("Successful", `  <br> Finalizing  <br> <br> <span class="spinner-border spinner-border sm">`, "success");
        };
        display_ajax_response(ajax_response, success_response);
      }
  </script>

  <%- include('../_admin_page_headers/admin_bottom') %>
</div>
